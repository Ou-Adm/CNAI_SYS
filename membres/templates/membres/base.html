{% load static %}
<!DOCTYPE html>
<html lang="fr" data-theme="black">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNAI Club</title>

    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="{% static 'membres/css/hero.css' %}?v=2">
    <link rel="stylesheet" href="{% static 'membres/css/navbar.css' %}?v=8">

    <style>
        body {
            background: radial-gradient(circle at top left, #1a1a2e, #000000 60%);
            min-height: 100vh;
        }

        .sidebar {
            background-color: rgba(20, 25, 40, 0.8) !important;
            backdrop-filter: blur(15px) !important;
            -webkit-backdrop-filter: blur(15px) !important;
            border-right: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.5);
        }

        .sidebar-nav li a:hover {
            background: rgba(168, 85, 247, 0.15) !important;
            border-right: 3px solid #a855f7;
            backdrop-filter: blur(5px);
        }
    </style>
</head>

<body class="{% if user.is_authenticated or is_member %}user-logged-in{% endif %}">

    <div id="page-transition-overlay" style="
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: #000; z-index: 99999; pointer-events: none;
        transition: opacity 0.8s ease-out;
    "></div>

    <nav class="navbar-custom">
        <div class="navbar-content">
            <a href="{% url 'index' %}" class="brand-logo group">
                <img src="{% static 'membres/images/new_l.png' %}" alt="CNAI Logo" 
                     class="logo-image transition-transform duration-300 group-hover:scale-110">
            </a>
            
            <div class="nav-links">
                <a href="{% url 'index' %}" class="nav-link">Accueil</a>
                <a href="{% url 'events' %}" class="nav-link">Événements</a>
                <a href="{% url 'team' %}" class="nav-link">Équipe</a>
                <a href="{% url 'contact' %}" class="nav-link">Contact</a>
            </div>

            <div style="display: flex; align-items: center; gap: 1rem;">
                {% if not user.is_authenticated and not is_member %}
                    <a href="{% url 'login' %}" class="signin-btn">Se connecter</a>
                {% endif %}
                
                <button class="hamburger-btn {% if user.is_authenticated or is_member %}visible-desktop{% endif %}" id="menuBtn" style="margin-left: 0.5rem;">
                    <span class="hamburger-line"></span><span class="hamburger-line"></span><span class="hamburger-line"></span>
                </button>
            </div>
        </div>
    </nav>

    <div class="overlay" id="overlay"></div>

    <aside class="sidebar" id="sidebar">
        <button class="sidebar-close" id="closeBtn">&times;</button>

        <ul class="sidebar-nav">
            <li class="nav-item-mobile"><a href="{% url 'index' %}"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>Accueil</span></a></li>
            <li class="nav-item-mobile"><a href="{% url 'team' %}"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg><span>Équipe</span></a></li>
            <li class="nav-item-mobile"><a href="{% url 'events' %}"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z"/></svg><span>Événements</span></a></li>
            <li class="nav-item-mobile"><a href="{% url 'contact' %}"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg><span>Contact</span></a></li>

            <div class="sidebar-divider"></div>

            {% if user.is_authenticated %}
                <div style="display: flex; gap: 10px; margin-bottom: 20px; padding: 0 10px;">
                    <a href="{% url 'scan' %}" style="flex:1; display:flex; flex-direction:column; align-items:center; padding:10px 5px; background:rgba(245,158,11,0.1); border:1px solid #f59e0b; border-radius:8px; text-decoration:none;">
                        <svg style="width:20px; height:20px; color:#f59e0b; margin-bottom:4px;" fill="currentColor" viewBox="0 0 24 24"><path d="M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm-6 8h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4h2v2h-2v-2zm0-4h2v2h-2v-2z"/></svg>
                        <span style="color:#f59e0b; font-size:0.7rem; font-weight:800;">SCANNER</span>
                    </a>
                    <a href="/admin/" target="_blank" style="flex:1; display:flex; flex-direction:column; align-items:center; padding:10px 5px; background:rgba(59,130,246,0.1); border:1px solid #3b82f6; border-radius:8px; text-decoration:none;">
                        <svg style="width:20px; height:20px; color:#3b82f6; margin-bottom:4px;" fill="currentColor" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.62l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.09-.47 0-.59.22L2.74 8.87c-.12.21-.08.48.12.62l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.62l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.09.47 0 .59-.22l1.92-3.32c.12-.22.07-.48-.12-.62l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                        <span style="color:#3b82f6; font-size:0.7rem; font-weight:800;">ADMIN DB</span>
                    </a>
                </div>
                
                <li><a href="/calendar/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg><span>Calendrier</span></a></li>
                <li><a href="/ranking/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/></svg><span>Points & Classement</span></a></li>
                <li><a href="/settings/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.62l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.09-.47 0-.59.22L2.74 8.87c-.12.21-.08.48.12.62l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.62l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.09.47 0 .59-.22l1.92-3.32c.12-.22.07-.48-.12-.62l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg><span>Paramètres</span></a></li>

            {% elif is_member %}
                <li><a href="/profile/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>Mon Profil</span></a></li>
                <li><a href="/calendar/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg><span>Calendrier</span></a></li>
                <li><a href="/ranking/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/></svg><span>Points & Classement</span></a></li>
                <li><a href="/certificate/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg><span>Mes Certificats</span></a></li>
                <li><a href="{% url 'my_qr' %}"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm-6 8h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4h2v2h-2v-2zm0-4h2v2h-2v-2z"/></svg><span>Mon QR Code</span></a></li>
                <li><a href="/settings/"><svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.62l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.09-.47 0-.59.22L2.74 8.87c-.12.21-.08.48.12.62l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.62l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.09.47 0 .59-.22l1.92-3.32c.12-.22.07-.48-.12-.62l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg><span>Paramètres</span></a></li>

            {% else %}
                <li>
                    <a href="{% url 'login' %}">
                        <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24" style="color: #667eea;">
                            <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
                        </svg>
                        <span>Se connecter</span>
                    </a>
                </li>
            {% endif %}
        </ul>

        {% if user.is_authenticated or is_member %}
            <a href="/logout/" class="logout-btn">Déconnexion</a>
        {% endif %}
    </aside>

    <div class="main-content">
        {% block content %}{% endblock %}
    </div>

    <footer style="background: #000; border-top: 1px solid rgba(255,255,255,0.1); padding: 60px 20px 30px 20px;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 40px; margin-bottom: 40px;">
                <div style="max-width: 300px;">
                    <h2 style="color: white; font-size: 1.5rem; font-weight: bold; margin-bottom: 15px;">CNAI ESTM</h2>
                    <p style="color: #666; font-size: 0.95rem;">Le club d'intelligence artificielle de l'EST Meknès. Innovation, Code, Futur.</p>
                </div>
                <div>
                    <h4 style="color: white; font-weight: bold; margin-bottom: 15px;">Navigation</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 10px;"><a href="{% url 'index' %}" style="color: #888; text-decoration: none;">Accueil</a></li>
                        <li style="margin-bottom: 10px;"><a href="{% url 'team' %}" style="color: #888; text-decoration: none;">Équipe</a></li>
                        <li style="margin-bottom: 10px;"><a href="{% url 'events' %}" style="color: #888; text-decoration: none;">Événements</a></li>
                    </ul>
                </div>
                <div id="contact">
                    <h4 style="color: white; font-weight: bold; margin-bottom: 15px;">Nous trouver</h4>
                    <p style="color: #888; margin-bottom: 10px;">EST Meknès, Maroc</p>
                    <p style="color: #888;">cnai.club@gmail.com</p>
                </div>
            </div>
            <div style="border-top: 1px solid rgba(255,255,255,0.05); padding-top: 20px; text-align: center;">
                <p style="color: #444; font-size: 0.8rem;">&copy; 2025 Clever Nest AI. Créé par adam ouaaziz.</p>
            </div>
        </div>
    </footer>

    <script src="{% static 'membres/js/sidebar.js' %}"></script>
    
    <script>
        function removeOverlay() {
            const overlay = document.getElementById('page-transition-overlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    if (overlay) overlay.remove();
                }, 800);
            }
        }
        window.addEventListener('load', removeOverlay);
        setTimeout(removeOverlay, 1500);
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) removeOverlay();
        });
    </script>

    {% if messages %}
    <div class="toast-container">
        {% for message in messages %}
            <div class="cyber-toast {% if message.tags %}{{ message.tags }}{% endif %}">
                <div class="toast-icon">
                    {% if message.tags == 'success' %}
                        <svg style="width:24px;height:24px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    {% else %}
                        <svg style="width:24px;height:24px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    {% endif %}
                </div>
                <div class="toast-content"><span class="toast-title">MESSAGE SYSTÈME:</span><span class="toast-text">{{ message }}</span></div>
                <div class="toast-close" onclick="this.parentElement.remove()">&times;</div>
            </div>
        {% endfor %}
    </div>
    <style>
        .toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 10000; display: flex; flex-direction: column; gap: 15px; }
        .cyber-toast { background: rgba(15, 15, 20, 0.95); border: 1px solid rgba(255,255,255,0.1); border-left: 4px solid #a855f7; border-radius: 4px; padding: 15px 20px; min-width: 320px; display: flex; align-items: center; gap: 15px; color: #fff; box-shadow: 0 10px 40px rgba(0,0,0,0.8); backdrop-filter: blur(10px); animation: slideIn 0.4s ease-out forwards; font-family: 'Courier New', monospace; }
        .cyber-toast.success { border-left-color: #27c93f; } .cyber-toast.error { border-left-color: #ff5f56; }
        .toast-icon { display: flex; align-items: center; justify-content: center; } .cyber-toast.success .toast-icon { color: #27c93f; } .cyber-toast.error .toast-icon { color: #ff5f56; }
        .toast-content { display: flex; flex-direction: column; flex: 1; } .toast-title { font-size: 0.7rem; color: #666; letter-spacing: 1px; font-weight: bold; } .toast-text { font-size: 0.9rem; color: #e0e0e0; line-height: 1.4; }
        .toast-close { color: #666; cursor: pointer; font-size: 1.5rem; line-height: 1; transition: 0.2s; } .toast-close:hover { color: white; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
    <script>
        setTimeout(() => {
            const toasts = document.querySelectorAll('.cyber-toast');
            toasts.forEach(toast => {
                toast.style.opacity = '0'; toast.style.transform = 'translateX(20px)'; toast.style.transition = 'all 0.5s ease';
                setTimeout(() => toast.remove(), 500);
            });
        }, 5000);
    </script>
    {% endif %}
</body>
</html>